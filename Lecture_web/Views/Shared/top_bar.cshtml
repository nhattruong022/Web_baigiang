@{
var avatar = !string.IsNullOrEmpty(ViewBag.Avatar as string) ? (string)ViewBag.Avatar : "/images/avatar.jpg";
var userName = !string.IsNullOrEmpty(ViewBag.UserName as string) ? (string)ViewBag.UserName : "User";
}
<header class="top-bar">

  <div class="user-menu">
    <div class="notifications">
      <i class="fas fa-bell"></i>
      <span class="notification-badge">5</span>
    </div>
    <div class="user-profile" onclick="toggleUserMenu()">
      <img src="@avatar" alt="User Avatar" class="avatar" id="topBarAvatar">
      <span class="user-name" id="topBarUserName">@userName</span>
      <i class="fas fa-chevron-down"></i>
      <div class="user-dropdown">
        <a href="/profile/profile">
          <i class="fas fa-user"></i>
          Thông tin cá nhân
        </a>
        <a href="#settings">
          <i class="fas fa-cog"></i>
          Cài đặt
        </a>
        <div class="dropdown-divider"></div>
        <a href="/profile/LogOut">
          <i class="fas fa-sign-out-alt"></i>
          Đăng xuất
        </a>
      </div>
    </div>
  </div>
</header>

<script>
  // Lắng nghe sự kiện avatar thay đổi từ các tab khác
  window.addEventListener('storage', function(event) {
    if (event.key === 'updatedAvatarUrl') {
      var topBarAvatar = document.getElementById('topBarAvatar');
      if (topBarAvatar) topBarAvatar.src = event.newValue + '?t=' + new Date().getTime();
    }
  });
</script>