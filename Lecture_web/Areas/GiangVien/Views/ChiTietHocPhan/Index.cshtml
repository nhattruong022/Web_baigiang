@{
ViewData["Title"] = "Chi tiết học phần";
var userRole = ViewBag.UserRole as string;
<link rel="stylesheet" href="~/css/chitiethocphan.css" />
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
}



<div class="app-container">
  <div class="header-row" style="display: flex; align-items: center; gap: 16px; margin: 24px 24px 0 32px;">
    <a style="text-decoration: none; color: #22334d;" href="/GiangVien/LopHoc/Index" class="back-btn">
      <i class="fas fa-arrow-left"></i> Quay lại
    </a>
    <div class="course-tabs">
      <button class="course-tab-btn active" onclick="showTab('lessons', this)"><i class="fas fa-book"></i> Bài giảng</button>
      <button class="course-tab-btn" onclick="showTab('students', this)"><i class="fas fa-users"></i> Danh sách sinh viên</button>
      <button class="course-tab-btn" onclick="showTab('notices', this)"><i class="fas fa-bell"></i> Thông báo</button>
    </div>
  </div>
  <div class="main-box" style="background: #fff; border-radius: 18px; box-shadow: 0 4px 24px rgba(52,152,219,0.10), 0 1.5px 8px rgba(0,0,0,0.08); border: 1.5px solid #bfc9d1; overflow: hidden; margin: 16px 24px 0 24px; display: flex; flex-direction: row; min-height: 650px;">
    <!-- Sidebar chương & bài -->
    <aside class="sidebar-chapters" style="border-radius: 0; min-height: 100%; height: 100%; box-shadow: none; margin: 0; width: 260px;">
      <h2>Chương & Bài</h2>
      <ul class="chapter-list">
        <li class="chapter open">
          <button class="chapter-title active" onclick="toggleChapter(this)">Chương 1: HTML cơ bản <i class="fas fa-chevron-down" style="margin-left:auto"></i></button>
          <ul class="lesson-list">
            <li><button class="lesson-btn active" onclick="showLesson(0,0)">Bài 1: Giới thiệu HTML</button></li>
            <li><button class="lesson-btn" onclick="showLesson(0,1)">Bài 2: Thẻ cơ bản</button></li>
          </ul>
        </li>
        <li class="chapter">
          <button class="chapter-title" onclick="toggleChapter(this)">Chương 2: CSS cơ bản <i class="fas fa-chevron-down" style="margin-left:auto"></i></button>
          <ul class="lesson-list">
            <li><button class="lesson-btn" onclick="showLesson(1,0)">Bài 1: Giới thiệu CSS</button></li>
            <li><button class="lesson-btn" onclick="showLesson(1,1)">Bài 2: Bộ chọn</button></li>
          </ul>
        </li>



      </ul>
    </aside>
    <div style="flex:1;display:flex;flex-direction:column;min-height: 600px;">
      <!-- Tab Contents -->
      <section class="main-lesson-content course-tab-content" id="tab-lessons" style="display:block;">
        <!-- Nội dung bài sẽ được render ở đây -->
      </section>
      <section class="main-lesson-content course-tab-content" id="tab-students" style="display:none;">
        <div class="management-header">
          <div class="search-filter">
            <select>
              <option>Tất cả vai trò</option>
              <option>Sinh viên</option>
              <option>Giảng viên</option>
            </select>
            <select>
              <option>Tất cả trạng thái</option>
              <option>Hoạt động</option>
              <option>Không hoạt động</option>
            </select>

          </div>
          <div style="display:flex; align-items:center; gap:12px;">
            <div class="search-box">
              <i class="fas fa-search"></i>
              <input type="text" placeholder="Tìm kiếm sinh viên...">
            </div>
            @if (userRole != "Sinhvien")
            {
            <button class="btn-primary" onclick="openAddStudentModal()" style="padding:8px 18px; font-size:1rem; border-radius:6px; margin-left:8px; display:flex; align-items:center; gap:8px; background-color: #3498db; color: #fff; border: none;">
              <i class="fas fa-user-plus"></i> Thêm sinh viên
            </button>
            }
          </div>
        </div>
        <div class="student-table">
          <table>
            <thead>
              <tr>
                <th>Tên đăng nhập</th>
                <th>Họ và tên</th>
                <th>Vai trò</th>
                <th>Email</th>
                <th>Số điện thoại</th>
                <th>Ảnh đại diện</th>
                <th>Trạng thái</th>
                @if (userRole != "Sinhvien")
                {
                <th>Thao tác</th>
                }
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>tranvanb</td>
                <td>Trần Văn B</td>
                <td>Sinh viên</td>
                <td>tranvanb@example.com</td>
                <td>0123456789</td>
                <td><img style="width:52px; height:52px; border-radius:50%;" src="~/images/avatar.jpg" class="student-avatar" /></td>
                <td><span class="status-badge active">Hoạt động</span></td>

                <td>
                  @if (userRole != "Sinhvien")
                  {
                  <button class="btn-icon" onclick="openEditStudentModal(this)"><i class="fas fa-edit"></i></button>
                  <button class="btn-icon" onclick="openConfirmDeleteStudentModal(this)"><i class="fas fa-trash"></i></button>
                  }
                </td>
              </tr>
              <!-- Thêm các dòng sinh viên khác -->
            </tbody>
          </table>
        </div>
        <!-- Phân trang -->
        <div class="pagination">
          <button>&lt;</button>
          <button class="active">1</button>
          <button>2</button>
          <button>3</button>
          <button>&gt;</button>
        </div>
        <!-- Popup Thêm sinh viên -->
        @if (userRole != "Sinhvien")
        {
        <div class="modal" id="addStudentModal" style="display:none; position:fixed; z-index:1000; left:0; top:0; width:100vw; height:100vh; background:rgba(44,62,80,0.18); justify-content:center; align-items:center;">
          <div class="modal-content add-student-modal-content">
            <div class="modal-header" style="display:flex; align-items:center; justify-content:space-between; border-bottom:1px solid #e0e6ed; padding-bottom:18px; margin-bottom:24px;">
              <h2 style="font-size:1.35rem; font-weight:700; color:#22334d; margin:0;">Thêm sinh viên</h2>
              <button onclick="closeAddStudentModal()" style="background:none; border:none; font-size:1.3rem; color:#888; cursor:pointer;"><i class="fas fa-times"></i></button>
            </div>
            <form id="addStudentForm" onsubmit="submitAddStudent(event)">
              <div class="form-group">
                <label for="studentUsername">Tên đăng nhập</label>
                <input type="text" id="studentUsername" required>
              </div>
              <div class="form-group">
                <label for="studentName">Họ và tên</label>
                <input type="text" id="studentName" required>
              </div>
              <div class="form-group">
                <label for="studentRole">Vai trò</label>
                <select id="studentRole" required>
                  <option value="student">Sinh viên</option>
                  <option value="teacher">Giảng viên</option>
                </select>
              </div>
              <div class="form-group">
                <label for="studentEmail">Email</label>
                <input type="email" id="studentEmail" required>
              </div>
              <div class="form-group">
                <label for="studentPhone">Số điện thoại</label>
                <input type="text" id="studentPhone">
              </div>
              <div class="form-group">
                <label for="studentAvatar">Ảnh đại diện</label>
                <input type="file" id="studentAvatar" accept="image/*">
              </div>
              <div class="form-group">
                <label for="studentStatus">Trạng thái</label>
                <select id="studentStatus" required>
                  <option value="active">Hoạt động</option>
                  <option value="inactive">Không hoạt động</option>
                </select>
              </div>
              <div class="form-actions modal-actions">
                <button type="button" onclick="closeAddStudentModal()" class="btn-cancel">Hủy</button>
                <button type="submit" class="btn-primary">Thêm sinh viên</button>
              </div>
            </form>
          </div>
        </div>
        }
        <!-- Popup chỉnh sửa sinh viên -->
        @if (userRole != "Sinhvien")
        {
        <div class="modal" id="editStudentModal" style="display:none; position:fixed; z-index:1001; left:0; top:0; width:100vw; height:100vh; background:rgba(44,62,80,0.18); justify-content:center; align-items:center;">
          <div class="modal-content add-student-modal-content">
            <div class="modal-header" style="display:flex; align-items:center; justify-content:space-between; border-bottom:1px solid #e0e6ed; padding-bottom:18px; margin-bottom:24px;">
              <h2 style="font-size:1.35rem; font-weight:700; color:#22334d; margin:0;">Chỉnh sửa sinh viên</h2>
              <button onclick="closeEditStudentModal()" style="background:none; border:none; font-size:1.3rem; color:#888; cursor:pointer;"><i class="fas fa-times"></i></button>
            </div>
            <form id="editStudentForm" onsubmit="submitEditStudent(event)">
              <div class="form-group">
                <label for="editStudentUsername">Tên đăng nhập</label>
                <input type="text" id="editStudentUsername" required>
              </div>
              <div class="form-group">
                <label for="editStudentName">Họ và tên</label>
                <input type="text" id="editStudentName" required>
              </div>
              <div class="form-group">
                <label for="editStudentRole">Vai trò</label>
                <select id="editStudentRole" required>
                  <option value="student">Sinh viên</option>
                  <option value="teacher">Giảng viên</option>
                </select>
              </div>
              <div class="form-group">
                <label for="editStudentEmail">Email</label>
                <input type="email" id="editStudentEmail" required>
              </div>
              <div class="form-group">
                <label for="editStudentPhone">Số điện thoại</label>
                <input type="text" id="editStudentPhone">
              </div>
              <div class="form-group">
                <label for="editStudentAvatar">Ảnh đại diện</label>
                <input type="file" id="editStudentAvatar" accept="image/*">
              </div>
              <div class="form-group">
                <label for="editStudentStatus">Trạng thái</label>
                <select id="editStudentStatus" required>
                  <option value="active">Hoạt động</option>
                  <option value="inactive">Không hoạt động</option>
                </select>
              </div>
              <div class="form-actions modal-actions">
                <button type="button" onclick="closeEditStudentModal()" class="btn-cancel">Hủy</button>
                <button type="submit" class="btn-primary">Lưu</button>
              </div>
            </form>
          </div>
        </div>
        }
        <!-- Modal xác nhận xóa sinh viên -->
        @if (userRole != "Sinhvien")
        {
        <div class="modal" id="confirmDeleteStudentModal" style="display:none; position:fixed; z-index:1002; left:0; top:0; width:100vw; height:100vh; background:rgba(44,62,80,0.18); justify-content:center; align-items:center;">
          <div class="modal-content" style="min-width:350px; max-width:400px; background:#fff; border-radius:14px; box-shadow:0 8px 32px rgba(52,152,219,0.18),0 1.5px 8px rgba(0,0,0,0.08); padding:32px 28px 24px 28px; position:relative; display:flex; flex-direction:column; align-items:center;">
            <h2 style="font-size:1.2rem; font-weight:600; color:#22334d; margin-bottom:18px; text-align:center;">Xác nhận xóa sinh viên?</h2>
            <div style="display:flex; justify-content:center; gap:16px; margin-top:18px;">
              <button type="button" onclick="closeConfirmDeleteStudentModal()" class="btn-cancel">Hủy</button>
              <button type="button" onclick="confirmDeleteStudent()" class="btn-primary" style="background:#e74c3c; border:none;">Xóa</button>
            </div>
          </div>
        </div>
        }
      </section>
      <section class="main-lesson-content course-tab-content" id="tab-notices" style="display:none;">
        <div class="notice-card">
          <div class="notice-header">
            <img src="~/images/avatar.jpg" alt="Avatar" class="notice-avatar">
            <div class="notice-info">
              <div class="notice-author">ND Duy</div>
              <div class="notice-time">3 thg 6</div>
            </div>
            <button class="notice-menu" onclick="toggleNoticeMenu(this)"><i class="fas fa-ellipsis-v"></i></button>
            @if (userRole != "Sinhvien")
            {
            <div class="notice-menu-popup" style="display:none; position:absolute; right:24px; top:48px; background:#fff; box-shadow:0 2px 8px rgba(44,62,80,0.12); border-radius:8px; min-width:160px; z-index:10;">

              <button onclick="addNotice()" class="notice-menu-item">Thêm thông báo</button>
              <button onclick="editNotice(this)" class="notice-menu-item">Sửa thông báo</button>
              <button onclick="deleteNotice(this)" class="notice-menu-item" style="color:#e74c3c;">Xóa thông báo</button>
            </div>
            }
          </div>
          <div class="notice-body">
            <p>
              Các nhóm lưu ý,<br>
              Không share tài liệu đồ án nhóm mình cho các nhóm khác (các nhóm không do Thầy hướng dẫn). Thầy đã cố gắng tạo các tài liệu cho khác nhau giữa các nhóm -> chia sẻ cho các bạn sẽ tạo ra những báo cáo giống nhau. Các em public ra -> sẽ bị các giáo viên, sinh viên khác biết Thầy tạo tài liệu cho các nhóm hướng dẫn -> fail chắc!<br>
              T.Duy<br>
              P/s: Vì có nhiều mail của các bạn không có trong nhóm -> yêu cầu quyền truy cập cái file Thầy gửi -> chứng tỏ trong nhóm có bạn share link.
            </p>
          </div>
          <div class="notice-comment">
            <img src="~/images/avatar.jpg" alt="Avatar" class="comment-avatar">
            <input type="text" placeholder="Thêm nhận xét trong lớp học...">
            <button class="comment-send"><i class="fas fa-paper-plane"></i></button>
          </div>
        </div>
        <div class="notice-card">
          <div class="notice-header">
            <img src="~/images/avatar.jpg" alt="Avatar" class="notice-avatar">
            <div class="notice-info">
              <div class="notice-author">Nguyễn Văn B</div>
              <div class="notice-time">1 thg 6</div>
            </div>
            <button class="notice-menu"><i class="fas fa-ellipsis-v"></i></button>
          </div>
          <div class="notice-body">
            <p>
              Lịch học tuần này chuyển sang phòng B203.<br>
              Các bạn chú ý đến đúng giờ!
            </p>
          </div>
          <div class="notice-comment">
            <img src="~/images/avatar.jpg" alt="Avatar" class="comment-avatar">
            <input type="text" placeholder="Thêm nhận xét trong lớp học...">
            <button class="comment-send"><i class="fas fa-paper-plane"></i></button>
          </div>
        </div>
        <div class="notice-card">
          <div class="notice-header">
            <img src="~/images/avatar.jpg" alt="Avatar" class="notice-avatar">
            <div class="notice-info">
              <div class="notice-author">Admin</div>
              <div class="notice-time">28 thg 5</div>
            </div>
            <button class="notice-menu"><i class="fas fa-ellipsis-v"></i></button>
          </div>
          <div class="notice-body">
            <p>
              Nhớ nộp bài tập chương 1 trước 10/06.<br>
              Nếu có thắc mắc liên hệ trợ giảng.
            </p>
          </div>
          <div class="notice-comment">
            <img src="~/images/avatar.jpg" alt="Avatar" class="comment-avatar">
            <input type="text" placeholder="Thêm nhận xét trong lớp học...">
            <button class="comment-send"><i class="fas fa-paper-plane"></i></button>
          </div>
        </div>
        <!-- Popup Thêm thông báo -->
        @if (userRole != "Sinhvien")
        {
        <div class="modal" id="addNoticeModal" style="display:none; position:fixed; z-index:1001; left:0; top:0; width:100vw; height:100vh; background:rgba(44,62,80,0.18); justify-content:center; align-items:center;">
          <div class="modal-content add-notice-modal-content">
            <div class="modal-header" style="display:flex; align-items:center; justify-content:space-between; border-bottom:1px solid #e0e6ed; padding-bottom:18px; margin-bottom:24px;">
              <h2 style="font-size:1.35rem; font-weight:700; color:#22334d; margin:0;">Thêm thông báo</h2>
              <button onclick="closeAddNoticeModal()" style="background:none; border:none; font-size:1.3rem; color:#888; cursor:pointer;"><i class="fas fa-times"></i></button>
            </div>
            <form id="addNoticeForm" onsubmit="submitAddNotice(event)">
              <div class="form-group">
                <label for="noticeTitle">Tiêu đề</label>
                <input type="text" id="noticeTitle" required>
              </div>
              <div class="form-group">
                <label for="noticeContent">Nội dung</label>
                <textarea id="noticeContent" rows="5" required style="resize:vertical;"></textarea>
              </div>
              <div class="modal-actions">
                <button type="button" onclick="closeAddNoticeModal()" class="btn-cancel">Hủy</button>
                <button type="submit" class="btn-primary">Thêm</button>
              </div>
            </form>
          </div>
        </div>
        }
        <!-- Popup Sửa thông báo -->
        @if (userRole != "Sinhvien")
        {
        <div class="modal" id="editNoticeModal" style="display:none; position:fixed; z-index:1001; left:0; top:0; width:100vw; height:100vh; background:rgba(44,62,80,0.18); justify-content:center; align-items:center;">
          <div class="modal-content add-notice-modal-content">
            <div class="modal-header" style="display:flex; align-items:center; justify-content:space-between; border-bottom:1px solid #e0e6ed; padding-bottom:18px; margin-bottom:24px;">
              <h2 style="font-size:1.35rem; font-weight:700; color:#22334d; margin:0;">Sửa thông báo</h2>
              <button onclick="closeEditNoticeModal()" style="background:none; border:none; font-size:1.3rem; color:#888; cursor:pointer;"><i class="fas fa-times"></i></button>
            </div>
            <form id="editNoticeForm" onsubmit="submitEditNotice(event)">
              <div class="form-group">
                <label for="editNoticeTitle">Tiêu đề</label>
                <input type="text" id="editNoticeTitle" required>
              </div>
              <div class="form-group">
                <label for="editNoticeContent">Nội dung</label>
                <textarea id="editNoticeContent" rows="5" required style="resize:vertical;"></textarea>
              </div>
              <div class="modal-actions">
                <button type="button" onclick="closeEditNoticeModal()" class="btn-cancel">Hủy</button>
                <button type="submit" class="btn-primary">Lưu</button>
              </div>
            </form>
          </div>
        </div>
        }
        <!-- Modal xác nhận xóa thông báo -->
        @if (userRole != "Sinhvien")
        {
        <div class="modal" id="confirmDeleteNoticeModal" style="display:none; position:fixed; z-index:1002; left:0; top:0; width:100vw; height:100vh; background:rgba(44,62,80,0.18); justify-content:center; align-items:center;">
          <div class="modal-content" style="min-width:350px; max-width:400px; background:#fff; border-radius:14px; box-shadow:0 8px 32px rgba(52,152,219,0.18),0 1.5px 8px rgba(0,0,0,0.08); padding:32px 28px 24px 28px; position:relative; display:flex; flex-direction:column; align-items:center;">
            <h2 style="font-size:1.2rem; font-weight:600; color:#22334d; margin-bottom:18px; text-align:center;">Xác nhận xóa thông báo?</h2>
            <div style="display:flex; justify-content:center; gap:16px; margin-top:18px;">
              <button type="button" onclick="closeConfirmDeleteNoticeModal()" class="btn-cancel">Hủy</button>
              <button type="button" onclick="confirmDeleteNotice()" class="btn-primary" style="background:#e74c3c; border:none;">Xóa</button>
            </div>
          </div>
        </div>
        }
      </section>
    </div>
  </div>
</div>



<script>
  // Dữ liệu mẫu
  const lessons = [
    [{
        title: 'Bài 1: Giới thiệu HTML',
        meta: 'Thời lượng: 45 phút | Tài liệu: 2 file',
        video: 'lecture1.mp4',
        materials: [{
            icon: 'fa-file-pdf',
            name: 'Slide bài giảng',
            link: '#',
            size: '2.5 MB'
          },
          {
            icon: 'fa-file-word',
            name: 'Tài liệu tham khảo',
            link: '#',
            size: '1.8 MB'
          }
        ],
        desc: 'Giới thiệu về HTML và cấu trúc cơ bản của một trang web.'
      },
      {
        title: 'Bài 2: Thẻ cơ bản',
        meta: 'Thời lượng: 30 phút | Tài liệu: 1 file',
        video: '',
        materials: [{
          icon: 'fa-file-pdf',
          name: 'Tài liệu PDF',
          link: '#',
          size: '1.2 MB'
        }],
        desc: 'Tìm hiểu các thẻ HTML cơ bản như h1, p, a, img...'
      }
    ],
    [{
        title: 'Bài 1: Giới thiệu CSS',
        meta: 'Thời lượng: 40 phút | Tài liệu: 1 file',
        video: '',
        materials: [{
          icon: 'fa-file-pdf',
          name: 'Slide CSS',
          link: '#',
          size: '1.1 MB'
        }],
        desc: 'Giới thiệu về CSS và cách áp dụng vào HTML.'
      },
      {
        title: 'Bài 2: Bộ chọn',
        meta: 'Thời lượng: 35 phút | Tài liệu: 1 file',
        video: '',
        materials: [{
          icon: 'fa-file-pdf',
          name: 'Tài liệu bộ chọn',
          link: '#',
          size: '1.0 MB'
        }],
        desc: 'Học về các loại bộ chọn trong CSS.'
      }
    ]
  ];
  // Hiển thị bài đầu tiên mặc định
  window.onload = function() {
    showLesson(0, 0);
  };

  function showLesson(chapterIdx, lessonIdx) {
    document.querySelectorAll('.lesson-btn').forEach(btn => btn.classList.remove('active'));
    const btns = document.querySelectorAll('.chapter')[chapterIdx].querySelectorAll('.lesson-btn');
    btns[lessonIdx].classList.add('active');
    const lesson = lessons[chapterIdx][lessonIdx];
    document.getElementById('tab-lessons').innerHTML = `
        <div class="lesson-header">
            <h1>${lesson.title}</h1>
            <div class="lesson-meta">${lesson.meta}</div>
        </div>
        <div class="lesson-body">
            ${lesson.video ? `<div class="lesson-video"><video controls><source src="${lesson.video}" type="video/mp4">Trình duyệt không hỗ trợ video.</video></div>` : ''}
            <div class="lesson-materials">
                <h4>Tài liệu bài giảng</h4>
                <ul>
                    ${lesson.materials.map(m => `<li><i class="fas ${m.icon}"></i> <a href="${m.link}">${m.name}</a> <span class="file-size">${m.size}</span></li>`).join('')}
                </ul>
            </div>
            <div class="lesson-desc">${lesson.desc}</div>
        </div>
        <div class="comments-section">
            <h2>Bình luận</h2>
            <form class="comment-form" onsubmit="event.preventDefault();">
                <textarea placeholder="Viết bình luận của bạn..."></textarea>
                <button type="submit">Gửi</button>
            </form>
            <div class="comments-list">
                <div class="comment">
                    <img src="avatar1.png" alt="User Avatar" class="comment-avatar">
                    <div class="comment-content">
                        <div class="comment-header">
                            <h4>Nguyễn Văn A</h4>
                            <span class="comment-time">2 giờ trước</span>
                        </div>
                        <p>Bài giảng rất hay và dễ hiểu. Cảm ơn thầy!</p>
                    </div>
                </div>
            </div>
        </div>
    `;
  }
  // Mở/đóng chương
  function toggleChapter(btn) {
    const li = btn.parentElement;
    li.classList.toggle('open');
    document.querySelectorAll('.chapter-title').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
  }
  // Tab switching for course detail
  function showTab(tab, btn) {
    document.querySelectorAll('.course-tab-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    document.querySelectorAll('.course-tab-content').forEach(c => c.style.display = 'none');
    document.getElementById('tab-' + tab).style.display = 'block';
    // Ẩn/hiện menu chương & bài
    var sidebar = document.querySelector('.sidebar-chapters');
    if (tab === 'lessons') {
      sidebar.style.display = 'block';
    } else {
      sidebar.style.display = 'none';
    }
  }

  function openAddStudentModal() {
    document.getElementById('addStudentModal').style.display = 'flex';
    document.getElementById('addStudentModal').style.alignItems = 'center';
    document.getElementById('addStudentModal').style.justifyContent = 'center';
    document.getElementById('addStudentForm').reset();
  }

  function closeAddStudentModal() {
    document.getElementById('addStudentModal').style.display = 'none';
  }

  function submitAddStudent(e) {
    e.preventDefault();
    // Lấy dữ liệu từ form
    const email = document.getElementById('studentEmail').value;
    const name = document.getElementById('studentName').value;
    const mssv = document.getElementById('studentUsername').value;
    const phone = document.getElementById('studentPhone').value;
    alert('Đã thêm sinh viên: ' + name + ' (' + email + ')');
    closeAddStudentModal();
  }

  function toggleNoticeMenu(btn) {
    // Đóng tất cả menu khác
    document.querySelectorAll('.notice-menu-popup').forEach(p => p.style.display = 'none');
    // Mở menu của thông báo này
    const popup = btn.parentElement.querySelector('.notice-menu-popup');
    if (popup) {
      popup.style.display = 'flex';
      // Đóng khi click ra ngoài
      setTimeout(() => {
        document.addEventListener('mousedown', closeNoticeMenuOnClickOutside);
      }, 0);
    }
  }

  function closeNoticeMenuOnClickOutside(e) {
    if (!e.target.closest('.notice-menu-popup') && !e.target.closest('.notice-menu')) {
      document.querySelectorAll('.notice-menu-popup').forEach(p => p.style.display = 'none');
      document.removeEventListener('mousedown', closeNoticeMenuOnClickOutside);
    }
  }

  function addNotice() {
    document.getElementById('addNoticeModal').style.display = 'flex';
    document.getElementById('addNoticeModal').style.alignItems = 'center';
    document.getElementById('addNoticeModal').style.justifyContent = 'center';
    document.getElementById('addNoticeForm').reset();
    document.querySelectorAll('.notice-menu-popup').forEach(p => p.style.display = 'none');
  }

  function closeAddNoticeModal() {
    document.getElementById('addNoticeModal').style.display = 'none';
  }

  function submitAddNotice(e) {
    e.preventDefault();
    // Lấy dữ liệu từ form
    const title = document.getElementById('noticeTitle').value;
    const content = document.getElementById('noticeContent').value;
    alert('Đã thêm thông báo: ' + title);
    closeAddNoticeModal();
  }
  let currentEditNoticeCard = null;
  let currentDeleteNoticeCard = null;

  function editNotice(btn) {
    // Lấy card hiện tại
    currentEditNoticeCard = btn.closest('.notice-card');
    // Lấy dữ liệu từ card (giả lập, thực tế nên lấy từ data hoặc API)
    const title = currentEditNoticeCard.querySelector('.notice-author')?.innerText || '';
    const content = currentEditNoticeCard.querySelector('.notice-body')?.innerText || '';
    document.getElementById('editNoticeTitle').value = title;
    document.getElementById('editNoticeContent').value = content;
    document.getElementById('editNoticeModal').style.display = 'flex';
    document.getElementById('editNoticeModal').style.alignItems = 'center';
    document.getElementById('editNoticeModal').style.justifyContent = 'center';
    document.getElementById('editNoticeForm').reset();
    document.querySelectorAll('.notice-menu-popup').forEach(p => p.style.display = 'none');
  }

  function closeEditNoticeModal() {
    document.getElementById('editNoticeModal').style.display = 'none';
  }

  function submitEditNotice(e) {
    e.preventDefault();
    // Lấy dữ liệu từ form
    const title = document.getElementById('editNoticeTitle').value;
    const content = document.getElementById('editNoticeContent').value;
    // Cập nhật lại giao diện (giả lập)
    if (currentEditNoticeCard) {
      currentEditNoticeCard.querySelector('.notice-author').innerText = title;
      currentEditNoticeCard.querySelector('.notice-body').innerText = content;
    }
    closeEditNoticeModal();
  }

  function deleteNotice(btn) {
    currentDeleteNoticeCard = btn.closest('.notice-card');
    document.getElementById('confirmDeleteNoticeModal').style.display = 'flex';
    document.getElementById('confirmDeleteNoticeModal').style.alignItems = 'center';
    document.getElementById('confirmDeleteNoticeModal').style.justifyContent = 'center';
    document.querySelectorAll('.notice-menu-popup').forEach(p => p.style.display = 'none');
  }

  function closeConfirmDeleteNoticeModal() {
    document.getElementById('confirmDeleteNoticeModal').style.display = 'none';
  }

  function confirmDeleteNotice() {
    if (currentDeleteNoticeCard) {
      currentDeleteNoticeCard.remove();
      currentDeleteNoticeCard = null;
    }
    closeConfirmDeleteNoticeModal();
  }

  function openEditStudentModal(btn) {
    // Lấy dòng sinh viên (giả lập, thực tế nên lấy từ data hoặc API)
    const row = btn.closest('tr');
    document.getElementById('editStudentUsername').value = row.children[0]?.innerText || '';
    document.getElementById('editStudentName').value = row.children[1]?.innerText || '';
    document.getElementById('editStudentRole').value = row.children[2]?.innerText || '';
    document.getElementById('editStudentEmail').value = row.children[3]?.innerText || '';
    document.getElementById('editStudentPhone').value = row.children[4]?.innerText || '';
    document.getElementById('editStudentAvatar').value = '';
    document.getElementById('editStudentStatus').value = row.querySelector('.status-badge')?.classList.contains('active') ? 'active' : 'inactive';
    document.getElementById('editStudentModal').style.display = 'flex';
    document.getElementById('editStudentModal').style.alignItems = 'center';
    document.getElementById('editStudentModal').style.justifyContent = 'center';
    document.getElementById('editStudentForm').reset();
  }

  function closeEditStudentModal() {
    document.getElementById('editStudentModal').style.display = 'none';
  }

  function submitEditStudent(e) {
    e.preventDefault();
    // Lấy dữ liệu từ form
    // Cập nhật lại giao diện nếu cần
    closeEditStudentModal();
  }
  let currentDeleteStudentRow = null;

  function openConfirmDeleteStudentModal(btn) {
    currentDeleteStudentRow = btn.closest('tr');
    document.getElementById('confirmDeleteStudentModal').style.display = 'flex';
    document.getElementById('confirmDeleteStudentModal').style.alignItems = 'center';
    document.getElementById('confirmDeleteStudentModal').style.justifyContent = 'center';
  }

  function closeConfirmDeleteStudentModal() {
    document.getElementById('confirmDeleteStudentModal').style.display = 'none';
  }


  function confirmDeleteStudent() {
    if (currentDeleteStudentRow) {
      currentDeleteStudentRow.remove();
      currentDeleteStudentRow = null;
    }
    closeConfirmDeleteStudentModal();
  }
</script>